# ğŸ” AI Image-to-Image Search Engine (Pure NumPy & DINOv2)

<div align="center">

![Python](https://img.shields.io/badge/Python-3.10+-blue.svg)
![NumPy](https://img.shields.io/badge/Backend-Pure%20NumPy-013243.svg)
![FastAPI](https://img.shields.io/badge/API-FastAPI-009688.svg)
![React](https://img.shields.io/badge/Frontend-React%20%2B%20Vite-61DAFB.svg)
![Tailwind](https://img.shields.io/badge/Style-TailwindCSS-38B2AC.svg)

**æ— éœ€ PyTorch/TensorFlow æ¨ç†æ¡†æ¶ï¼Œæ‰‹æ“ NumPy çŸ©é˜µè¿ç®—å®ç° Vision Transformer (DINOv2) å‰å‘ä¼ æ’­ã€‚**

[æ¼”ç¤º Demo] Â· [æŠ¥å‘Š Bug] Â· [åŠŸèƒ½è¯·æ±‚]

</div>

---

## ğŸ“– é¡¹ç›®ç®€ä»‹
æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªç«¯åˆ°ç«¯çš„ AI å›¾åƒæ£€ç´¢ï¼ˆä»¥å›¾æœå›¾ï¼‰ç³»ç»Ÿï¼Œä»…é€šè¿‡åŸºç¡€ç§‘å­¦è®¡ç®—åº“ `NumPy` å®Œæ•´å¤ç° Meta å¼€æºçš„ DINOv2 (Vision Transformer) æ¨¡å‹æ¨ç†æµç¨‹ã€‚

å‰ç«¯åŸºäº React + TailwindCSS æ„å»ºï¼Œä¸ä»…å®ç°å›¾ç‰‡ä¸Šä¼ ã€ç›¸ä¼¼å›¾æ£€ç´¢ç­‰æ ¸å¿ƒåŠŸèƒ½ï¼Œè¿˜æ‰©å±•äº†**æ¨ç† Pipeline å¯è§†åŒ–**ã€**ç›¸ä¼¼åº¦åˆ†å¸ƒç»Ÿè®¡**ã€**å¤šå›¾å¯¹æ¯”**ã€**æ£€ç´¢å†å²å›æº¯**ç­‰è¿›é˜¶èƒ½åŠ›ï¼Œå…¼é¡¾ç®—æ³•åŸç†æ¼”ç¤ºçš„æ•™å­¦ä»·å€¼ä¸ç”Ÿäº§çº§åˆ«çš„äº¤äº’ä½“éªŒã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

###  ğŸŒŸ æ ¸å¿ƒåˆ›æ–°ç‚¹

#### 1. åç«¯ï¼šæè‡´çš„ NumPy ç®—å­æ‰‹æ“ (dinov2_numpy.py)
æœ¬é¡¹ç›®å¹¶æœªè°ƒç”¨ torch æˆ– onnxruntime è¿›è¡Œæ¨ç†ï¼Œè€Œæ˜¯å®Œå…¨é€šè¿‡ NumPy å®ç°äº† Transformer çš„æ¯ä¸€ä¸ªç»†èŠ‚ã€‚è¿™å¯¹äºç†è§£æ·±åº¦å­¦ä¹ åº•å±‚åŸç†å…·æœ‰æé«˜ä»·å€¼ã€‚

æ‰‹åŠ¨å®ç°åŒä¸‰æ¬¡æ’å€¼ (Cubic B-Spline): åœ¨ _bspline3 å’Œ _zoom_spline3_nearest ä¸­ï¼Œæˆ‘ä»¬æ‰‹åŠ¨å®ç°äº†å¤æ‚çš„æ’å€¼ç®—æ³•ï¼Œç”¨äºå¤„ç†ä½ç½®ç¼–ç ï¼ˆPositional Embeddingï¼‰çš„åŠ¨æ€åˆ†è¾¨ç‡è°ƒæ•´ã€‚è¿™æ˜¯ ViT æ¨¡å‹é€‚åº”ä¸åŒè¾“å…¥å°ºå¯¸çš„å…³é”®ï¼Œé€šå¸¸ç”±æ¡†æ¶å°è£…ï¼Œè€Œè¿™é‡Œè¿›è¡Œäº†åº•å±‚æ•°å­¦å¤ç°ã€‚

Transformer å®Œæ•´å¤ç°: ä» MultiHeadAttention åˆ° LayerNorm (å« epsilon)ï¼Œå†åˆ° GELU æ¿€æ´»å‡½æ•°ï¼Œå…¨éƒ¨ä½¿ç”¨ np.matmul, np.tanh ç­‰åŸºç¡€ç®—å­æ„å»ºã€‚

æƒé‡æ˜ å°„: ç¼–å†™äº†ä¸“é—¨çš„åŠ è½½é€»è¾‘ï¼Œå°†é¢„è®­ç»ƒçš„ PyTorch æƒé‡æ— ç¼è½¬æ¢ä¸º NumPy æ•°ç»„æ ¼å¼ï¼Œå®ç°äº†æ¨¡å‹ç»“æ„çš„ç²¾ç¡®å¯¹é½ã€‚

#### 2. å‰ç«¯ï¼šæ•°æ®é©±åŠ¨çš„äº¤äº’ä½“éªŒ (App.tsx)
ä¸ä»…ä»…æ˜¯å±•ç¤ºç»“æœï¼Œæ›´æ˜¯ä¸€ä¸ªåˆ†æå·¥å…·ã€‚

Pipeline å¯è§†åŒ–: å®æ—¶å±•ç¤º Upload -> Preprocess -> Embed -> Search -> Rank çš„å„é˜¶æ®µè€—æ—¶ï¼Œè®©ç”¨æˆ·æ„ŸçŸ¥ AI å¤„ç†çš„å…¨æµç¨‹ã€‚

ä¸°å¯Œçš„å›¾è¡¨åˆ†æ: åˆ©ç”¨ Recharts ç»˜åˆ¶æ£€ç´¢ç»“æœçš„ç›¸ä¼¼åº¦åˆ†å¸ƒåŒºåŸŸå›¾å’Œåˆ†ç±»æ¦‚ç‡æŸ±çŠ¶å›¾ã€‚

é«˜çº§äº¤äº’:

ç€‘å¸ƒæµ/å¯†é›†ç½‘æ ¼åˆ‡æ¢: é€‚åº”ä¸åŒæµè§ˆä¹ æƒ¯ã€‚

å¯¹æ¯”æ¨¡å¼ (Compare Mode): å…è®¸ç”¨æˆ·é€‰ä¸­ä¸¤å¼ ç»“æœå›¾è¿›è¡Œå¹¶æ’è¯¦ç»†å‚æ•°å¯¹æ¯”ï¼ˆCosine è·ç¦» vs è‡ªå®šä¹‰ Scoreï¼‰ã€‚

ç²’å­ç‰¹æ•ˆä¸ç»ç’ƒæ‹Ÿæ€: çº¯ CSS/JS å®ç°çš„èƒŒæ™¯ç²’å­åŠ¨ç”»å’Œç£¨ç ‚ç»ç’ƒæ•ˆæœï¼Œæå‡è§†è§‰è´¨æ„Ÿã€‚

## ğŸ“‚ ç›®å½•ç»“æ„
AI_Image_to_Image/

â”œâ”€â”€ dinov2_numpy.py          # [æ ¸å¿ƒ] çº¯ NumPy å®ç°çš„ DINOv2 æ¨¡å‹

â”œâ”€â”€ server.py                # [æ ¸å¿ƒ] FastAPI åç«¯ï¼Œå¤„ç†æ£€ç´¢é€»è¾‘

â”œâ”€â”€ debug.py                 # è°ƒè¯•è„šæœ¬ï¼Œç”¨äºæ¯”å¯¹ç‰¹å¾æå–ç²¾åº¦

â”œâ”€â”€ requirements.txt         # (éœ€è‡ªè¡Œç”Ÿæˆ) Python ä¾èµ–

â”œâ”€â”€ demo_data/               # æ¼”ç¤ºç”¨çš„å‚è€ƒæ•°æ®

â”‚   â”œâ”€â”€ cat.jpg

â”‚   â””â”€â”€ cat_dog_feature.npy

â”œâ”€â”€ gallery_features.npy     # å›¾åº“ç‰¹å¾å‘é‡

â”œâ”€â”€ gallery_meta.csv         # å›¾åº“å…ƒæ•°æ®

â””â”€â”€ src/                     # React å‰ç«¯æºç 

    â”œâ”€â”€ App.tsx              # ä¸»åº”ç”¨é€»è¾‘ä¸ UI ç»„ä»¶
    
    â”œâ”€â”€ api.ts               # å‰åç«¯æ¥å£å®šä¹‰
    
    â”œâ”€â”€ types.ts             # TypeScript ç±»å‹å®šä¹‰
    
    â”œâ”€â”€ utils.ts             # å·¥å…·å‡½æ•°
    
    â””â”€â”€ index.css            # Tailwind æ ·å¼å…¥å£
    

## ğŸš€ ç¯å¢ƒé…ç½®ä¸å¯åŠ¨
### å‰ç½®è¦æ±‚
Python 3.10+

Node.js 16+

å›¾åº“æ•°æ®ï¼ˆéœ€å‡†å¤‡ gallery_features.npy å’Œ gallery_meta.csvï¼‰

### 1. åç«¯å¯åŠ¨ (Backend)
Bash

### 1. å®‰è£… Python ä¾èµ–
pip install numpy pandas fastapi uvicorn python-multipart pillow

### 2. å‡†å¤‡æ¨¡å‹æƒé‡
ç¡®ä¿ vit-dinov2-base.npz ä½äºé¡¹ç›®æ ¹ç›®å½• (éœ€ä» PyTorch æƒé‡è½¬æ¢)

### 3. å‡†å¤‡å›¾åº“æ•°æ®
ç¡®ä¿ gallery_features.npy å’Œ gallery_meta.csv å­˜åœ¨

### 4. å¯åŠ¨æœåŠ¡å™¨
python -m uvicorn server:app --reload --host 0.0.0.0 --port 8000


### 2. å‰ç«¯å¯åŠ¨ (Frontend)
Bash

### 1. å®‰è£… Node ä¾èµ–
npm install

### 2. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

### 3. è®¿é—®
#### æ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost:5173


## ğŸ”Œ æ¥å£è¯´æ˜
POST /api/retrieve

è¯·æ±‚ï¼šmultipart/form-data

file: ä¸Šä¼ å›¾ç‰‡

source: catdog æˆ– whic

å“åº”ç¤ºä¾‹ï¼š

{

  "source": "whic",
  
  â€œpredicted_label": "landscape",
  
  "elapsed_ms": 123,
  
  "gallery_size": 30000,
  
  "topk": [
  
    {"rank": 1, "image_url": "...", "caption": "...", "cosine": 0.73, "score": 88.2}
  ]
}


### è¯´æ˜ï¼š

#### Cat/Dog æ˜¯é—­é›†äºŒåˆ†ç±»ï¼šä»»ä½•è¾“å…¥éƒ½ä¼šè¾“å‡º cat/dog æ¦‚ç‡ï¼ˆå¹¶ä¸ä»£è¡¨çœŸçš„å±äºçŒ«ç‹—ï¼‰

#### WHIC æ›´åâ€œæ£€ç´¢â€ï¼šæœ¬é¡¹ç›®åœ¨å‰ç«¯åŸºäº Top-50 captions æå–å…³é”®è¯ä¸åœºæ™¯åˆ¤æ–­ï¼Œè®©å±•ç¤ºæ›´â€œæ™ºèƒ½â€

### ğŸ§¯ å¸¸è§é—®é¢˜
#### 1) åç«¯å¯åŠ¨æŠ¥é”™ï¼špython-multipart æœªå®‰è£…
pip install python-multipart

#### 2) æ‰“å¼€ http://127.0.0.1:8000/ æ˜¯ 404

æ­£å¸¸ç°è±¡ã€‚è¯·è®¿é—®ï¼š

http://127.0.0.1:8000/health

#### 3) å‰ç«¯è¯·æ±‚å¤±è´¥

æ£€æŸ¥åç«¯æ˜¯å¦å·²å¯åŠ¨ï¼ˆ8000ï¼‰

æ£€æŸ¥ .envï¼šVITE_API_BASE=http://127.0.0.1:8000

ç¡®ä¿ VITE_USE_MOCK=false

#### 4) ç›¸ä¼¼åº¦åä½

å¸¸è§åŸå› ï¼š

å›¾åº“åˆ†å¸ƒå¤æ‚/åŸŸå·®å¼‚å¤§ï¼ˆç½‘ç»œå›¾ç‰‡è´¨é‡å‚å·®ï¼‰

CLS å…¨å±€å‘é‡åâ€œè¯­ä¹‰çº§â€ï¼Œä½™å¼¦ä¸ä¸€å®šå¾ˆé«˜

query ä¸å›¾åº“é¢„å¤„ç†å¿…é¡»ä¸¥æ ¼ä¸€è‡´ï¼ˆresize/crop/normï¼‰
